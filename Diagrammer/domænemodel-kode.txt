@startuml

class User {
    - int id
    - String email
    - String passwordHash
    - String role
    - String username
    - String phone
    - boolean paymentAttached
    - double balance
    - Timestamp createdAt
}

class Cart {
    - List<CartItem> items
}

class CartItem {
    - Integer productId
    - Integer flavorId
    - Integer toppingId
    - String name
    - double unitPrice
    - int quantity
    - String displayName
}

class PaymentInfo {
    - int id
    - String cardNumber
    - String cardholderName
    - int expiryMonth
    - int expiryYear
    - String cvvHash
    - Timestamp createdAt
}

class CupcakeFlavor {
    - int id
    - String name
    - double price
}

class CupcakeTopping {
    - int id
    - String name
    - double price
}

class Category {
    - int id
    - String name
}

class Product {
    - int id
    - String name
    - String description
    - double price
    - String imageUrl
    - int categoryId
    - int topping_id
    - int flavor_id
    - Timestamp createdAt
}

class DeliveryMethod {
    - int id
    - String name
    - double price
}

class PaymentMethod {
    - int id
    - String name
}

class Order {
    - int id
    - User user
    - String status
    - Timestamp createdAt
    - ArrayList<OrderItem> items
    - Integer deliveryMethodId
    - Integer paymentMethodId
    - String deliveryAddress
    - double totalPrice
    - OrderItemMapper orderItemMapper
}

class OrderItem {
    - int id
    - int productId
    - int bottomId
    - int toppingId
    - String toppingName
    - String bottomName
    - int quantity
    - String title
    - String description
    - double price
    - String displayName
    - boolean customCupcake
}

class Transaction {
    - int id
    - int userId
    - double amount
    - String description
    - Timestamp createdAt
}

class Coupon {
    - int id
    - String code
    - int discountPercent
    - Timestamp validFrom
    - Timestamp validUntil
}

class Refund {
    - int id
    - int orderId
    - int userId
    - String reason
    - Timestamp createdAt
    - String status
}

User "1" -- "0..*" PaymentInfo : has
User "1" -- "0..*" Order : places
User "1" -- "0..*" Transaction : owns
User "1" -- "0..*" Refund : requests
User "1" -- "0..1" Cart : has

Cart "1" -- "0..*" CartItem : contains
CartItem "1" -- "1" Product : refersTo
CartItem "0..1" -- "0..1" CupcakeFlavor : selectedFlavor
CartItem "0..1" -- "0..1" CupcakeTopping : selectedTopping

Order "1" -- "1..*" OrderItem : contains
Order "0..1" -- "0..1" DeliveryMethod : uses
Order "0..1" -- "0..1" PaymentMethod : paysWith
Order "0..1" -- "0..1" Coupon : applies
Order "1" -- "0..*" Refund : generates

OrderItem "1" -- "1" Product : refersTo
OrderItem "0..1" -- "0..1" CupcakeFlavor : selectedFlavor
OrderItem "0..1" -- "0..1" CupcakeTopping : selectedTopping

Product "0..1" -- "0..*" Category : belongsTo
Product "0..1" -- "0..1" CupcakeFlavor : hasFlavor
Product "0..1" -- "0..1" CupcakeTopping : hasTopping

@enduml