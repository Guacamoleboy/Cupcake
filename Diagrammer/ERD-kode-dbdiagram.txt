Table users {
  id serial [pk]
  email varchar(255) [unique, not null]
  password_hash text [not null]
  role varchar(20) [not null, default: 'customer']
  username varchar(100) [unique, not null]
  phone varchar(20) [unique]
  payment_attached boolean [default: false]
  balance decimal(12,2) [default: 0.00]
  created_at timestamp [default: `now()`]
}

Table payment_info {
  id serial [pk]
  user_id int [not null, ref: > users.id]
  card_number varchar(19) [not null]
  cardholder_name varchar(255) [not null]
  expiry_month int [not null]
  expiry_year int [not null]
  cvv_hash text [not null]
  created_at timestamp [default: `now()`]
  Note: 'expiry_month CHECK (1-12), expiry_year CHECK (2025-2100)'
}

Table cupcake_flavor {
  id serial [pk]
  name varchar(100) [not null]
  price decimal(10,2) [not null]
}

Table cupcake_toppings {
  id serial [pk]
  name varchar(100) [not null]
  price decimal(10,2) [not null]
}

Table categories {
  id serial [pk]
  name varchar(100) [unique, not null]
}

Table products {
  id serial [pk]
  name varchar(150) [not null]
  description text
  price decimal(10,2) [not null]
  image_url text
  category_id int [ref: > categories.id]
  topping_id int [ref: > cupcake_toppings.id]
  flavor_id int [ref: > cupcake_flavor.id]
  created_at timestamp [default: `now()`]
}

Table delivery_methods {
  id serial [pk]
  name varchar(50) [unique, not null]
  price decimal(10,2) [not null, default: 0.0]
}

Table payment_methods {
  id serial [pk]
  name varchar(50) [unique, not null]
}

Table orders {
  id serial [pk]
  user_id int [ref: > users.id]
  status varchar(20) [not null, default: 'open']
  delivery_method_id int [ref: > delivery_methods.id]
  payment_method_id int [ref: > payment_methods.id]
  delivery_address text
  created_at timestamp [default: `now()`]
}

Table order_items {
  id serial [pk]
  order_id int [ref: > orders.id]
  product_id int [ref: > products.id]
  bottom_id int [ref: > cupcake_flavor.id]
  topping_id int [ref: > cupcake_toppings.id]
  quantity int [not null, default: 1]
}

Table transactions {
  id serial [pk]
  user_id int [ref: > users.id]
  amount decimal(10,2) [not null]
  created_at timestamp [default: `now()`]
  description text
}

Table coupons {
  id serial [pk]
  code varchar(50) [unique, not null]
  discount_percent int [not null]
  valid_from timestamp [default: `now()`]
  valid_until timestamp
  Note: 'discount_percent CHECK (1â€“100)'
}

Table refunds {
  id serial [pk]
  order_id int [not null, ref: > orders.id]
  user_id int [not null, ref: > users.id]
  reason varchar(255) [not null]
  created_at timestamp [default: `now()`]
  status varchar(50) [not null, default: 'active']
}